/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var AOI = ee.FeatureCollection("users/pedroamoni/AOI");
/***** End of imports. If edited, may not auto-convert in the playground. *****/
var geometry = AOI
Map.setCenter(-55.52921735575856,-12.940544989159335,12)

// Adiciona uma coleção de imagens Sentinel 2
var S2 = ee.ImageCollection('COPERNICUS/S2')

// Filtra a data das imagens a serem analisadas
// Utilizar ANO-MÊS-DIA
.filterDate('2020-06-01', '2020-06-30')

// Filtra e clipa a imagem de acordo com a AOI
.filterBounds(geometry);

// Função para limpar imagens com nuvens 
var maskcloud1 = function(image) {
var QA10 = image.select(['QA10']);
return image.updateMask(QA10.lt(1));
};

// Função para calcular o NDVI
var addNDVI = function(image) {
return image.addBands(image.normalizedDifference(['B8', 'B4']));
};

// Adiciona a banda NDVI a coleção de imagem
var S2 = S2.map(addNDVI);
// Cria a média da banda NDVI
var NDVI = S2.select(['nd']);
var NDVImed = NDVI.median();

// Cria a paleta de cores aplicada a imagem NDVI
var ndvi_pal = ['#640000', '#ff0000', '#ffff00', '#00c800', '#006400'];

// Cria gráfico de séries
var plotNDVI = ui.Chart.image.seriesByRegion(S2, geometry,ee.Reducer.mean(),
'nd',500,'system:time_start', 'system:index')
              .setChartType('LineChart').setOptions({
                title: 'Série NDVI',
                hAxis: {title: 'Data'},
                vAxis: {title: 'NDVI'}
});

// Display.
print(plotNDVI);

// Display NDVI results on map
Map.addLayer(NDVImed.clip(geometry), {min:-0.5, max:1.5, palette: ndvi_pal}, 'NDVI');



//Display RGB results on map
// This finds the median value of all the pixels which meet the criteria.
var medianpixels = S2.median()  

// this cuts up the result so that it fits neatly into your aoi
// and divides so that values between 0 and 1 
var medianpixelsclipped = medianpixels.clip(AOI).divide(10000) 


// Now visualise the mosaic as a natural colour image. 
Map.addLayer(medianpixelsclipped, {bands: ['B4', 'B3', 'B2'], min: 0, max: 1, gamma: 3}, 'RGB')






